<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Emily & Travis ‚Äî RSVP</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Delius+Swash+Caps&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: Georgia, serif;
      background: #0a0a0a;
      color: #e8e1c7;
    }

    .forest {
      min-height: 100vh;
      background: url("assets/assets/backgrounds/insidegate.png") center / cover no-repeat;
      position: relative;
      padding: 5rem 1.5rem;
    }

    .forest::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(
          circle at center,
          rgba(10,10,10,0.25) 0%,
          rgba(10,10,10,0.45) 60%,
          rgba(10,10,10,0.6) 100%
        );
      z-index: 1;
    }

    .content {
      position: relative;
      z-index: 2;
      max-width: 680px;
      margin: 0 auto;
    }

    h1 {
      font-family: 'Delius Swash Caps', cursive;
      color: #f3d37a;
      font-size: 3rem;
      text-align: center;
      margin-bottom: 2rem;
      text-shadow: 0 0 18px rgba(243,211,122,0.6);
    }

    label { display: block; margin-top: 1.5rem; margin-bottom: 0.4rem; }

    input, select {
      width: 100%;
      padding: 0.75rem;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
    }

    button {
      margin-top: 2rem;
      width: 100%;
      padding: 0.9rem;
      background: #f3d37a;
      color: #0a0a0a;
      border: none;
      border-radius: 6px;
      font-size: 1.1rem;
      cursor: pointer;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .hidden { display: none; }

    .response {
      margin-top: 2.5rem;
      padding: 2rem;
      background: rgba(10,10,10,0.6);
      border-radius: 8px;
      text-align: center;
      font-size: 1.05rem;
    }

    .registry-btn {
      display: inline-block;
      margin-top: 1.5rem;
      padding: 0.7rem 1.4rem;
      background: #f3d37a;
      color: #0a0a0a;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
    }

    @media (max-width: 768px) {
      h1 { font-size: 2.2rem; }
    }
  </style>
</head>
<body>

<div class="forest">
  <div class="content">

    <h1>RSVP</h1>

    <form id="rsvpForm">
      <label>Guest name(s)</label>
      <input type="text" required>

      <label>Will you attend?</label>
      <select id="attendance" required>
        <option value="">Select</option>
        <option value="yes">Yes, with joy</option>
        <option value="no">Regretfully, no</option>
      </select>

      <div id="yesFields" class="hidden">
        <label>Plus one?</label>
        <select>
          <option value="">Select</option>
          <option>No</option>
          <option>Yes</option>
        </select>

        <label>Number of children attending</label>
        <input type="number" min="0" max="6" value="0">
      </div>

      <label>Contact (email or phone)</label>
      <input id="contactField" type="text" placeholder="Required if attending ‚Äî optional if not">

      <button type="submit">Send RSVP</button>
    </form>

    <div id="responseBox" class="response hidden">
      <p style="opacity:0.9; margin-bottom:0.8rem;">
  Your RSVP has been received.
</p>
      <p id="responseText"></p>

      <div id="codeSection" style="margin-top: 1.8rem;">
        <p style="margin-bottom: 0.4rem;">Have a forest code?</p>
        <input id="forestCodeInput" type="text" placeholder="Enter your code">
        <button id="forestCodeButton" style="margin-top: 0.8rem;">Enter</button>
        <p id="codeMessage" style="margin-top: 1rem; font-size: 0.95rem;"></p>
        <p id="unlockStatus" style="margin-top: 0.6rem; font-size: 0.85rem; opacity: 0.8;"></p>
      </div>

      <a href="registry.html" id="registryLink" class="registry-btn hidden">
        Visit the Registry
      </a>

      <div style="margin-top: 1.5rem; display: flex; justify-content: space-between; font-size: 0.9rem;">
        <span id="editResponse" style="cursor: pointer; text-decoration: underline;">
          Need to update your response?
        </span>

        <span style="text-decoration: underline; opacity: 0.6; cursor: default;"
              title="Available after entering your forest code">
          Simple Mode ¬∑ Phone Friendly
        </span>
      </div>
    </div>

  </div>
</div>

<script>
  // ===== RSVP FORM LOGIC =====
  const attendance = document.getElementById("attendance");
  const yesFields = document.getElementById("yesFields");
  const form = document.getElementById("rsvpForm");
  const responseBox = document.getElementById("responseBox");
  const responseText = document.getElementById("responseText");
  const registryLink = document.getElementById("registryLink");
  const contactField = document.getElementById("contactField");

  const yesMessages = [
    "A lantern just flickered on somewhere ‚Äî we‚Äôre glad it‚Äôs for you.",
    "We‚Äôre really excited to have you there. Truly.",
    "This celebration feels more complete knowing you‚Äôre coming.",
    "Some paths are better shared. Thanks for walking this one with us.",
    "We‚Äôre looking forward to celebrating with you under the trees.",
    "This day already feels warmer knowing you‚Äôll be part of it.",
    "We‚Äôre glad our paths cross here.",
    "Your spot is waiting.",
    "This made us pause and smile.",
    "We‚Äôre excited to welcome you into this little moment of magic.",
    "The evening will be better with you there.",
    "We‚Äôre happy you‚Äôll be joining us for this.",
    "This feels right. Thank you for coming.",
    "We‚Äôre genuinely excited to celebrate together.",
    "You belong at this table, under these lights.",
    "We‚Äôre thankful you‚Äôll be there to share the day.",
    "This gathering wouldn‚Äôt feel the same without you.",
    "We‚Äôre so glad you can make it.",
    "A quiet little cheer happened when we saw your response.",
    "We‚Äôre happy to be celebrating with you.",
    "This moment feels brighter knowing you‚Äôre part of it.",
    "We can‚Äôt wait to see you there.",
    "Your presence adds something special to the day.",
    "We‚Äôre really looking forward to this with you.",
    "This celebration just gained a little more heart.",
    "We‚Äôre glad you‚Äôll be there when it happens.",
    "Thanks for joining us for this chapter.",
    "This day will hold a place for you.",
    "We‚Äôre grateful you‚Äôll be celebrating alongside us.",
    "We‚Äôre so happy you‚Äôre coming."
  ];

  const noMessages = [
    "Thank you for letting us know ‚Äî we appreciate it.",
    "We‚Äôll miss you, but we‚Äôre glad you took the time to respond.",
    "Thanks for answering ‚Äî it truly helps.",
    "We understand completely. Thank you for replying.",
    "We appreciate you letting us know either way.",
    "Though you won‚Äôt be there, we‚Äôre still thankful for you.",
    "Thanks for the response ‚Äî it means a lot.",
    "We‚Äôll miss seeing you, but we understand.",
    "Thank you for taking a moment to reply.",
    "We appreciate the honesty and the care.",
    "Thanks for keeping us in the loop.",
    "We‚Äôre grateful you shared your answer with us.",
    "We‚Äôll miss you, but we understand this season of life.",
    "Thank you for responding ‚Äî truly.",
    "We appreciate you letting us know.",
    "Thanks for the heads-up.",
    "We‚Äôre thankful you took the time to answer.",
    "We‚Äôll miss you, but we‚Äôre glad you reached out.",
    "Thank you for replying so thoughtfully.",
    "We understand, and we appreciate the response.",
    "Thanks for letting us know what works for you.",
    "We‚Äôll be thinking of you that day.",
    "Thank you for responding with care.",
    "We appreciate you taking a moment for us.",
    "We‚Äôll miss celebrating with you, but we understand.",
    "Thank you for the reply ‚Äî it means more than you know.",
    "We‚Äôre grateful you answered either way.",
    "Thanks for keeping us informed.",
    "We appreciate your response.",
    "Sending thanks your way."
  ];

  attendance.addEventListener("change", () => {
    const isYes = attendance.value === "yes";
    yesFields.classList.toggle("hidden", !isYes);
    contactField.required = isYes;
  });

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    form.classList.add("hidden");
    responseBox.classList.remove("hidden");

    if (attendance.value === "yes") {
      responseText.textContent = yesMessages[Math.floor(Math.random() * yesMessages.length)];
    } else {
      responseText.textContent = noMessages[Math.floor(Math.random() * noMessages.length)];
      registryLink.classList.remove("hidden");
    }
  });

  document.getElementById("editResponse").addEventListener("click", () => {
    responseBox.classList.add("hidden");
    form.classList.remove("hidden");
    registryLink.classList.add("hidden");
    contactField.required = false;
  });

  // ===== FOREST CODE SYSTEM (50 CODES + ESCALATION + STATUS + LOCKOUT) =====
  const UNLOCK_KEY = "forestUnlocked";
  const ATTEMPT_KEY = "forestAttempts";
  const LOCKOUT_KEY = "forestLockoutUntil";

  // 50 placeholder guest codes: FOREST001 ... FOREST050
  const VALID_CODES = Array.from({ length: 50 }, (_, i) => `FOREST${String(i + 1).padStart(3, "0")}`);

  const codeInput = document.getElementById("forestCodeInput");
  const codeButton = document.getElementById("forestCodeButton");
  const codeMessage = document.getElementById("codeMessage");
  const unlockStatus = document.getElementById("unlockStatus");

  let attempts = Number(sessionStorage.getItem(ATTEMPT_KEY)) || 0;

  const tiers = [
    { max: 2, messages: [
      "Are you sure you put the code in correctly?",
      "That doesn‚Äôt seem to be the right code. Try again.",
      "Close the tabs for a sec and retype it slowly.",
      "Check for extra spaces. The forest is picky.",
      "Try again ‚Äî codes are case-sensitive."
    ]},
    { max: 5, messages: [
      "The forest pauses‚Ä¶ then says no.",
      "That invitation doesn‚Äôt open this door.",
      "A fairy double-checks the list.",
      "The lantern flickers‚Ä¶ then goes dark.",
      "The gate remains unimpressed."
    ]},
    { max: 9, messages: [
      "Go back and check the message Emily sent you.",
      "That‚Äôs not the code you were given.",
      "Bestie‚Ä¶ reread the text. It‚Äôs right there.",
      "Try copying it exactly as it was sent.",
      "The forest suggests: check your messages."
    ]},
    { max: 19, messages: [
      "The forest is starting to ask questions.",
      "This feels‚Ä¶ persistent.",
      "Are you sure this invitation was meant for you?",
      "The gate is confused by your commitment.",
      "At this point, we‚Äôre concerned (but supportive).",
      "Okay. Deep breath. Go verify the code."
    ]},
    { max: Infinity, messages: [
      "Girl‚Ä¶ are you even invited?!",
      "Who told you to come??????",
      "Why the FUCK are you trying so hard to get in? Are YOU okay?",
      "This door has been tried. Repeatedly.",
      "The forest has summoned a therapist.",
      "üìç Locating emotional support professional‚Ä¶",
      "At this point, we need you to go drink water and check your texts."
    ]}
  ];

  function pickMessage(count) {
    for (const tier of tiers) {
      if (count <= tier.max) {
        return tier.messages[Math.floor(Math.random() * tier.messages.length)];
      }
    }
    return "No.";
  }

  function setLockoutUI() {
    const lockoutUntil = Number(sessionStorage.getItem(LOCKOUT_KEY)) || 0;
    if (Date.now() < lockoutUntil) {
      codeButton.disabled = true;
      codeMessage.textContent = "Okay. Pause. The forest has locked itself for a few minutes.";
      return true;
    }
    codeButton.disabled = false;
    return false;
  }

  // Already unlocked indicator
  if (sessionStorage.getItem(UNLOCK_KEY) === "true") {
    unlockStatus.textContent = "The forest is already open to you.";
  }

  // If currently locked out, disable button
  setLockoutUI();

  codeButton.addEventListener("click", () => {
    // Respect lockout
    if (setLockoutUI()) return;

    const entered = codeInput.value.trim().toUpperCase();

    if (VALID_CODES.includes(entered)) {
      sessionStorage.setItem(UNLOCK_KEY, "true");
      sessionStorage.removeItem(ATTEMPT_KEY);
      sessionStorage.removeItem(LOCKOUT_KEY);
      window.location.href = "landing.html";
      return;
    }

    // Wrong code path
    attempts++;
    sessionStorage.setItem(ATTEMPT_KEY, attempts);

    // Escalate message
    codeMessage.textContent = pickMessage(attempts);

    // Lockout after 30 failed attempts (5 minutes)
    if (attempts >= 30) {
      sessionStorage.setItem(LOCKOUT_KEY, Date.now() + (5 * 60 * 1000));
      setLockoutUI();
    }
  });
</script>

<script src="js/main.js"></script>
</body>
</html>
